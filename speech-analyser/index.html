<!DOCTYPE html>
<html>
<head>
    <title>Speech to text test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
</head>
<body>

<div id="app">
    <div class="container">
        <div class="row">
            <h1 class="page-header">
                Speech to text.
            </h1>
        </div>

        <div class="row">
            <div class="col">
                <div class="result">

                </div>
            </div>
        </div>
    </div>
</div>

<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

    $( function () {

        var socket = io( document.location.origin );


        /************************************************/
        // TRACKING

        var resultDiv = document.querySelector( '.result' );
        var final_transcript = '';
        var recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.onresult = function ( event ) {
            console.log( event )

            var interim_transcript = '';
            if ( typeof( event.results) == 'undefined' ) {
                recognition.onend = null;
                recognition.stop();
                upgrade();
                return;
            }
            for ( var i = event.resultIndex; i < event.results.length; ++i ) {
                if ( event.results[ i ].isFinal ) {
                    final_transcript += event.results[ i ][ 0 ].transcript;
                } else {
                    interim_transcript += event.results[ i ][ 0 ].transcript;
                }
            }

            resultDiv.innerHTML = interim_transcript;
        };

        recognition.start();

    } );

</script>
</body>
</html>